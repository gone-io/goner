<p>
    English&nbsp ｜&nbsp <a href="README_CN.md">中文</a>
</p>

# goner/otel/log

## Overview

`goner/otel/log` is a component in the Gone framework that provides OpenTelemetry logging capabilities. This module integrates with the OpenTelemetry logging system, enabling applications to create, record, and export log data, helping developers better monitor and diagnose issues in distributed systems.

## Key Features

- Provides initialization and configuration for OpenTelemetry logging system
- Supports creating and managing log records
- Integrates with Gone framework's lifecycle management to ensure proper flushing and closing of logging system when application shuts down
- Supports multiple log export methods
- Seamless integration with OpenTelemetry's Trace and Metrics

## Submodules

- `goner/otel/log/http`: Provides OpenTelemetry log data exporter via HTTP protocol
- `goner/otel/log/grpc`: Provides OpenTelemetry log data exporter via gRPC protocol

## Installation

```bash
# Install base logging module
gonectl install goner/otel/log

# Install HTTP exporter
gonectl install goner/otel/log/http

# Install gRPC exporter
gonectl install goner/otel/log/grpc
```

## Simple Example

> Demonstrates exporting log data to OpenTelemetry Collector via `goner/otel/log` component

### Run the following commands

```bash
gonectl create -t otel/log/simple simple-demo
cd simple-demo
go run .
```

### Project Structure

```log
.
├── config/
│   └── default.yaml
├── go.mod
├── go.sum
├── main.go
└── module.load.go
```

### Code

- [module.load.go](../../examples/otel/log/simple/module.load.go), generated by running `gonectl install goner/otel/log`

```go
// Code generated by gonectl. DO NOT EDIT.
package main

import(
	"github.com/gone-io/gone/v2"
	"github.com/gone-io/goner/g"
	"github.com/gone-io/goner/otel/log"
	"github.com/gone-io/goner/viper"
	zap "github.com/gone-io/goner/zap"
)

// load installed gone module LoadFunc
var loaders = []gone.LoadFunc{
	log.Register,
	viper.Load,
	zap.Load,
}

func GoneModuleLoad(loader gone.Loader) error {
	var ops []*g.LoadOp
	for _, f := range loaders {
		ops = append(ops, g.F(f))
	}
	return g.BuildOnceLoadFunc(ops...)(loader)
}
```

- [main.go](../../examples/otel/log/simple/main.go), entry point

```go
package main

import "github.com/gone-io/gone/v2"

func main() {
	gone.
		Loads(GoneModuleLoad).
		Run(func(logger gone.Logger) {
			logger.Infof("hello world")
			logger.Errorf("error info")
		})
}
```

- [config/default.yaml](../../examples/otel/log/simple/config/default.yaml), configuration file

```yaml
service:
  name: &serviceName "log-collect-example"

otel:
  service:
    name: *serviceName
  log:
    http:
      endpoint: localhost:4318
      insecure: true
  tracer:
    http:
      endpoint: localhost:4318
      insecure: true

log:
  otel:
    enable: true
    log-name: *serviceName
    only: false
```

## Advanced Configuration

### Configuration Options

In the configuration file, you can control logging behavior with these options:

```yaml
log:
  otel:
    enable: true       # Whether to enable OpenTelemetry log collection
    log-name: "app"    # Log name
    only: false        # Whether to use only OpenTelemetry logs (no console output)
```

### Checking OpenTelemetry/Log Usage in Custom Components with Fallback
```go
type YourComponent struct {
    isOtelLogLoaded g.IsOtelLogLoaded `gone:"*"`
}

func(s*YourComponent)BusinessLogic(){
	if s.isOtelLogLoaded{
		// Handle logging logic
    } else{
	    // Fallback handling without OpenTelemetry logs
    }
}
```

## Best Practices

1. **Proper Log Level Configuration**: Set appropriate log levels based on environment (development, testing, production)
2. **Structured Logging**: Use structured logging for easier analysis
3. **Trace Correlation**: Correlate logs with trace information in distributed systems
4. **Effective Field Usage**: Add fields that aid problem diagnosis but avoid excessive unnecessary information
5. **Performance Considerations**: Use logs judiciously in high-concurrency scenarios to avoid performance bottlenecks

## FAQ

### Log Data Not Exported Correctly

- Verify Collector address and port
- Check network connectivity
- Look for export error messages in application logs

### Logs Not Correlated with Trace Information

- Ensure service name is configured correctly
- Verify Trace context propagation
- Confirm logs contain trace information when recorded

### Performance Issues

- Adjust log levels
- Optimize log content and structure
- Consider using asynchronous log processing

## References

- [OpenTelemetry Documentation](https://opentelemetry.io/docs/)
- [OpenTelemetry Logs Specification](https://opentelemetry.io/docs/specs/otel/logs/)
- [Gone Framework Documentation](https://github.com/gone-io/gone)